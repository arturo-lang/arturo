name: Build number

on:
    push:
        branches:
            - master

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: false

jobs:
  Bump:
    runs-on: ubuntu-latest
    if: github.event.head_commit.author.email != 'actions@github.com'
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
            fetch-depth: 0
            token: ${{ secrets.PAT_TOKEN }}
      
      - name: Configure Git
        run: |
            git config user.name "GitHub Actions Bot"
            git config user.email "actions@github.com"
      
      - name: Increment build number
        id: bump
        run: |
            current_build=$(cat version/build)
            new_build=$((current_build + 1))
            echo $new_build > version/build

            echo "current=$new_build" >> $GITHUB_OUTPUT
            
            echo "Bumped build: $current_build â†’ $new_build"
      
      - name: Commit and push
        run: |
            git add version/build
            git commit -m "Bump build to ${{ steps.bump.outputs.current }} [skip ci]"
            git push origin master
 