name: Revision

on:
    push:
        branches:
            - master
        paths-ignore:
            - 'version/**'

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: false

jobs:
  Bump:
    runs-on: ubuntu-latest
    if: github.event.head_commit.author.email != 'actions@github.com'
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
            fetch-depth: 0
            token: ${{ secrets.PAT_TOKEN }}
      
      - name: Configure Git
        run: |
            git config user.name "GitHub Actions Bot"
            git config user.email "actions@github.com"
      
      - name: Increment revision number
        id: bump
        run: |
            current_revision=$(cat version/revision)
            new_revision=$((current_revision + 1))
            echo $new_revision > version/revision

            echo "current=$new_revision" >> $GITHUB_OUTPUT

            echo "Bumped revision: $current_revision â†’ $new_revision"

      - name: Commit and push
        run: |
            git add version/revision
            git commit -m "Bump revision to ${{ steps.bump.outputs.current }} [skip ci]"
            git push origin master
 